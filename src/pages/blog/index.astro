---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import BlogContent from '../../components/BlogContent.astro';
import { getCollection } from 'astro:content';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';
import siteSettings from '../../data/site-settings.json';

const lang = getLangFromUrl(Astro.url);
const translation = useTranslations(lang);
const allPosts = await getCollection('blog', (entry) => entry.data.lang === lang);
const posts = allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<Layout title={`${translation('blog.title')} - ${siteSettings.site.name}`} description={translation('blog.subtitle')}>
  <Header />
  <BlogContent posts={posts} lang={lang} translation={translation} />
  <Footer />
</Layout>
